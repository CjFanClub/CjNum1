name: Production Release

on:
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write

jobs:
  update_config:
    runs-on: ubuntu-latest
    # Job 全体のタイムアウト時間を指定
    timeout-minutes: 5
    steps:
      # 開発用ブランチを指定
      - name: checkout
        uses: actions/checkout@v4
        with:
          ref: "develop"
      - name: Create pull request and tag
        shell: bash
        # まずDraft状態で作成する。
        run: |
          PR_TITLE="Release at $(TZ='JST-9' date --date "8 days" +%Y.%m.%d)"
          TAG_VERSION=express_$(date --date "8 days" +%Y%m%d)
          ASSIGNEE="ji-liu"
          REVIEWER="ji-liu"

          gh pr create -d --base "staging" --title "$PR_TITLE" --body "Auto-generated pull request, not generated " --assignee "$ASSIGNEE" --reviewer "$REVIEWER"
          git tag $TAG_VERSION -m "Release $TAG_VERSION"
          git push origin $TAG_VERSION
        env:
          GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}